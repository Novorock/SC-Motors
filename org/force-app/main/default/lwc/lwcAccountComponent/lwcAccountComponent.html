<!-- sldsValidatorIgnore -->
<template>
    <template if:true={isRecordPage}>
        <lightning-card>

            <div class="c-container">
                <div class="slds-p-around_small">
                    <span style="font-weight: bold">
                        Total Price: <lightning-formatted-number value={accountData.Total} format-style="currency"
                            currency-code="EUR"></lightning-formatted-number>
                    </span>
                </div>

                <div class="slds-scrollable slds-p-around_small">
                    <table style="border-bottom: none"
                        class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped" role="grid"
                        aria-labelledby="element-with-table-label other-element-with-table-label">
                        <thead>
                            <th scope="col">Opportunity Name</th>
                            <th scope="col">Created Date</th>
                            <th scope="col">Close Date</th>
                            <th scope="col">Amount</th>

                            <th class="slds-cell_action-mode" scope="col" style="width:3.25rem">
                                <div class="slds-truncate slds-assistive-text" title="Actions">Actions</div>
                            </th>
                        </thead>

                        <tbody>
                            <template for:each={accountData.Opportunities} for:item="opp">
                                <tr key={opp.Id} class="slds-hint-parent" role="gridcell">
                                    <th data-label="Opportunity Name" scope="row">
                                        <div class="slds-truncate" title={opp.Name}>
                                            <a data-id={opp.Id} onclick={handleRedirect} tabindex="-1">{opp.Name}</a>
                                        </div>
                                    </th>

                                    <td data-label="Created Date" role="gridcell">
                                        <div class="slds-truncate" title="Created Date">
                                            <lightning-formatted-date-time value={opp.CreatedDate} year="numeric"
                                                month="numeric" day="numeric" hour="2-digit" minute="2-digit">
                                            </lightning-formatted-date-time>
                                        </div>
                                    </td>

                                    <td data-label="Close Date" role="gridcell">
                                        <div class="slds-truncate" title="Close Date">
                                            <lightning-formatted-date-time value={opp.CloseDate} year="numeric"
                                                month="numeric" day="numeric" hour="2-digit" minute="2-digit">
                                            </lightning-formatted-date-time>
                                        </div>
                                    </td>

                                    <td data-label="Created Date" role="gridcell">
                                        <div class="slds-truncate" title="Amount">
                                            <lightning-formatted-number value={opp.Amount} format-style="currency"
                                                currency-code="EUR"></lightning-formatted-number>
                                        </div>
                                    </td>

                                    <td class="slds-cell_action-mode" role="gridcell">
                                        <lightning-button-icon class="slds-m-left_xx-small" icon-name="utility:list"
                                            data-id={opp.Id} data-title={opp.Name} variant="brand" onclick={handleOpenModal}
                                            alternative-text="Details">
                                        </lightning-button-icon>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </lightning-card>
    </template>

    <template if:false={isRecordPage}>
        <lightning-card>
            <div class="slds-grid" slot="title">
                <div class="slds-col">
                    <lightning-icon icon-name="utility:money" size="small"></lightning-icon>
                </div>

                <div class="slds-col slds-p-left_x-small">
                    Sales per Account
                </div>
            </div>

            <div slot="footer">
                <lightning-button-icon disabled={paginationContext.previousDisabled}
                    class="slds-m-left_x-small slds slds-p-around_medium" icon-name="utility:chevronleft"
                    variant="brand" onclick={handlePreviousPage} alternative-text="Previous">
                </lightning-button-icon>

                <span>
                    {paginationContext.currentPage} page of {paginationContext.pagesTotalAmount}
                </span>

                <lightning-button-icon disabled={paginationContext.nextDisabled}
                    class="slds-m-left_x-small slds slds-p-around_medium" icon-name="utility:chevronright"
                    variant="brand" onclick={handleNextPage} alternative-text="Next">
                </lightning-button-icon>
            </div>

            <div class="c-container" style="border-top: 2px solid #e5e5e5">
                <div>
                    <div class="slds-p-around_medium lgc-bg">
                        <lightning-input
                            type="text"
                            placeholder="Enter Name and Total Price"
                            label="Quick Find:"
                            onchange={handleQuickFind}
                            >
                        </lightning-input>
                    </div>
                </div>

                <lightning-accordion>
                    <template if:false={isEmptyList} for:each={accountData} for:item="item">
                        <lightning-accordion-section class="slds-grid" key={item.Id} label={item.Title}>
                            <div style="margin: 0 auto" class="slds-scrollable slds-size_10-of-12">
                                <table style="border-bottom: none"
                                    class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped"
                                    role="grid"
                                    aria-labelledby="element-with-table-label other-element-with-table-label">
                                    <thead>
                                        <th scope="col">Opportunity Name</th>
                                        <th scope="col">Created Date</th>
                                        <th scope="col">Close Date</th>
                                        <th scope="col">Amount</th>

                                        <th class="slds-cell_action-mode" scope="col" style="width:3.25rem">
                                            <div class="slds-truncate slds-assistive-text" title="Actions">Actions</div>
                                        </th>
                                    </thead>

                                    <tbody>
                                        <template for:each={item.Opportunities} for:item="opp">
                                            <tr key={opp.Id} class="slds-hint-parent" role="gridcell">
                                                <th data-label="Opportunity Name" scope="row">
                                                    <div class="slds-truncate" title={opp.Name}>
                                                        <a data-id={opp.Id} onclick={handleRedirect}
                                                            tabindex="-1">{opp.Name}</a>
                                                    </div>
                                                </th>

                                                <td data-label="Created Date" role="gridcell">
                                                    <div class="slds-truncate" title="Created Date">
                                                        <lightning-formatted-date-time value={opp.CreatedDate}
                                                            year="numeric" month="numeric" day="numeric" hour="2-digit"
                                                            minute="2-digit">
                                                        </lightning-formatted-date-time>
                                                    </div>
                                                </td>

                                                <td data-label="Close Date" role="gridcell">
                                                    <div class="slds-truncate" title="Close Date">
                                                        <lightning-formatted-date-time value={opp.CloseDate}
                                                            year="numeric" month="numeric" day="numeric" hour="2-digit"
                                                            minute="2-digit">
                                                        </lightning-formatted-date-time>
                                                    </div>
                                                </td>

                                                <td data-label="Created Date" role="gridcell">
                                                    <div class="slds-truncate" title="Amount">
                                                        <lightning-formatted-number value={opp.Amount}
                                                            format-style="currency"
                                                            currency-code="EUR"></lightning-formatted-number>
                                                    </div>
                                                </td>

                                                <td class="slds-cell_action-mode" role="gridcell">
                                                    <lightning-button-icon class="slds-m-left_xx-small"
                                                        icon-name="utility:list" data-id={opp.Id} data-title={opp.Name}
                                                        variant="brand" onclick={handleOpenModal}
                                                        alternative-text="Details">
                                                    </lightning-button-icon>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </lightning-accordion-section>
                    </template>
                </lightning-accordion>

                <template if:true={isEmptyList}>
                    <div class="slds-text-align_center slds-text-heading_medium slds-text-color_inverse-weak">
                        No accounts were found.
                    </div>
                </template>
            </div>
        </lightning-card>
    </template>

    <template if:true={isModalOpen}>
        <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
            class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <div class="slds-modal__header">
                    <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate">
                        {modalContext.title}
                    </h1>
                </div>

                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <template if:false={modalContext.empty}>
                        <ul class="slds-has-dividers_bottom-space">
                            <template for:each={modalContext.items} for:item="item">
                                <li key={item.Id} class="slds-item" style="font-weight: bold">{item.Product2.Name}</li>

                                <li key={item.Id} class="slds-item">
                                    <ul class="slds-is-nested">
                                        <li>Quantity: {item.Quantity}</li>
                                        <li>Total price: €{item.TotalPrice}</li>
                                    </ul>
                                </li>
                            </template>
                        </ul>
                    </template>

                    <temaplte if:true={modalContext.empty}>
                        <div class="slds-text-align_center slds-text-heading_medium slds-text-color_inverse-weak">
                            The list of opportunity products is empty.
                        </div>
                    </temaplte>
                </div>

                <div class="slds-modal__footer">
                    <button class="slds-button slds-button_brand" onclick={handleCloseModal}
                        aria-label="Cancel">Cancel</button>
                </div>
            </div>
        </section>

        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
    </template>
</template>